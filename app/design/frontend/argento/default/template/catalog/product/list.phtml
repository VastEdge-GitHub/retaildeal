<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?> 
<style>
.sorter { border-left: none; border-right: none;}
.tabs { clear: both; float: left;width:100%; margin-top:-35px; padding-left:15px; border-bottom:1px solid #e1e1e1; position:relative; z-index:970;/*z-index:1000;*/
}
.tabs li{
display: inline;list-style: none;
 }
.tabs li a{ color: #414040; display: block; float:left; font-size: 14px; font-weight:bold; padding:12px 12px; background-color:#eee; border:1px solid #ddd;  border-bottom:none; margin-bottom: -1px; text-decoration: none; border-radius: 5px 5px 0 0;
} 
.tabs .active li{ background:#fff; }

.category-products .sorter .view-mode { display: none;}
.toolbar { float:right; position:relative; z-index: 985;/*z-index: 1010;*/} 
.toolbar-bottom .toolbar{ float:none !important}
.toolbar .pager{display:none;}
.toolbar .sorter { border: none;}
.toolbar-bottom .tabs-view { display:none;}
.sorter .sort-by { margin-right: -10px}
.toolbar-bottom { margin-bottom: 10px;}
.sorter { position: relative; z-index: 99999;} 
.toolbar-bottom .sorter .view-mode { display: block;}
.toolbar-bottom .toolbar .sorter { border: 1px solid #E6E6E7;}
.toolbar-bottom .sorter .sort-by { margin-right: 0;}
.toolbar-bottom .toolbar .pager { width: 99%; display: inline-block;}
</style>

<?php 
$vmod = $_GET["mod"];
if($vmod =='all')
 {
?>
<style>
.aal{ background:#fff !important;}
.feturred{ background:#eee !important; }
</style>
<?php } else{ ?>
<style>
.feturred{ background:#fff !important;}
.aal{ background:#eee !important;}
</style>
<?php } ?>


<!-- RD-588 inline css  --->
<style>
.product-name{font-family:'Source Sans Pro',sans-serif; line-height:1.25; margin:10px 0 0 0; float:left; width:100%;}
</style>
<!-- RD-588 inline css  --->

<?php 
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?> 
 <?php
	$currentUrl = $this->helper('core/url')->getCurrentUrl();
	$SearchUrl	    = 'catalogsearch/result/'; 
	$homeUtm		= "retaildeal.biz/?utm_source";
	$homeLimit		= 'retaildeal.biz/?limit';
	$manufacturer	= '?manufacturer=';
	$price			= 'price=';
	if(Mage::getBlockSingleton('page/html_header')->getIsHomePage())  
	{
		$_productCollection=$this->getLoadedProductCollection();				
	}
	else
	{
		if(stripos($currentUrl, $SearchUrl) != false || (stripos($currentUrl, $homeUtm) != false) || (stripos($currentUrl, $homeLimit) != false) || 
			(stripos($currentUrl, $price) != false))
		{   
			$_productCollection=$this->getLoadedProductCollection(); 
		}
		else{
			$viewmod = $_GET["mod"]; 
			if($viewmod == 'featured' || $viewmod =='')
			{
				$cat_id = Mage::getModel('catalog/layer')->getCurrentCategory()->getId();
				$_productCollection = Mage::getResourceModel('catalog/product_collection')
				->addAttributeToFilter('featured', array('eq' => array(1)))
				->addAttributeToSelect('*')
				->addCategoryFilter(Mage::getModel('catalog/category')->load($cat_id));			 
	
			}
			else
			{
				$_productCollection=$this->getLoadedProductCollection();
			}
		}
	}
	$this->getToolbarBlock()->setCollection($_productCollection);
	$_helper = $this->helper('catalog/output');
	$lazy_img = $this->getSkinUrl('images/mgt_lazy_image_loader/loader.gif');
	$imag_helper = $this->helper('catalog/image');
  ?>
<?php if(!$_productCollection->count()): ?>
<div class="category-products" style="margin-top:35px">
    <?php echo $this->getToolbarHtml() ?>
<br clear="all"/><p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
</div>

<?php else: ?>
<div class="category-products">
    <?php echo $this->getToolbarHtml() ?>
   <?php echo $this->getAdditionalHtml() ?>
	 
    <?php // List mode ?>
    <?php if($this->getMode()!='grid'): ?>
    <?php $_iterator = 0; ?>
	
<!--RD-515--->	
	

    <ol class="products-list" id="products-list">
    <?php foreach ($_productCollection as $_product): ?>
        <li class="item<?php if( ++$_iterator == sizeof($_productCollection) ): ?> last<?php endif; ?>">
            <?php // Product Image ?>
            <div class="prolabel-wrapper">
                <?php echo Mage::helper('prolabels')->getLabel($_product, 'category'); ?>
                <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(135); ?>" width="135" height="135" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" /></a>
            </div>
            <?php if (Mage::helper('core')->isModuleOutputEnabled('TM_QuickShopping')) : ?>
                <?php echo Mage::helper('quickshopping')->getViewButton($this->__('Quick View'), $_product, $this->getMode(), null, $_productCollection); ?>
            <?php endif ?>
            <?php // Product description ?>
            <div class="product-shop">
                <div class="f-fix">
                    <?php $_productNameStripped = $this->stripTags($_product->getName(), null, true); ?>
                    <p style="font-family:'Source Sans Pro',sans-serif; line-height:1.25" class="product-name"><a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $_productNameStripped; ?>"><?php echo $_product->getName(); ?></a></p>
                    <?php echo $this->getPriceHtml($_product, true) ?>
                    <?php if($_product->isSaleable()): ?>
                        <p><button type="button" title="<?php echo $this->__('Add to Cart') ?>" class="button btn-cart" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button></p>
                    <?php else: ?>
                        <?php if ($_product->getIsSalable()): ?>
                            <p class="availability in-stock"><span><?php echo $this->__('In stock') ?></span></p>
                        <?php else: ?>
                            <?php if ($_product->getIsSalable()): ?>
                                <p class="availability in-stock"><span><?php echo $this->__('In stock') ?></span></p>
                            <?php else: ?>
                                <p class="availability out-of-stock"><span><?php echo $this->__('Out of stock') ?></span></p>
                            <?php endif; ?>
                        <?php endif; ?>
                    <?php endif; ?>
                    <div class="desc std">
                        <?php echo $_product->getShortDescription(); ?>
                        <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $_productNameStripped ?>" class="link-learn"><?php echo $this->__('Learn More') ?></a>
                    </div>
                </div>
            </div>
        </li>
    <?php endforeach; ?>
    </ol>
    <script type="text/javascript">decorateList('products-list', 'none-recursive')</script>

      <?php else: ?>

    <?php // Grid Mode ?> 

    <?php $_collectionSize = $_productCollection->count() ?>
    <?php $_columnCount = $this->getColumnCount(); ?>
	
<!--RD-515--->	
<!-- end RD-515--->
    <?php $i=0; foreach ($_productCollection as $_product): ?>	

        <?php if ($i++%$_columnCount==0): ?>
        <ul class="products-grid">
        <?php endif ?>
		<!-- Custom code added to shift description below MSRP and to remove Add To Cart button from list of products -->
            <li class="item<?php if(($i-1)%$_columnCount==0): ?> first<?php elseif($i%$_columnCount==0): ?> last<?php endif; ?>">
                <div class="prolabel-wrapper">
                    <?php echo Mage::helper('prolabels')->getLabel($_product, 'category'); ?>
                    <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image'); ?>" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" width="200px" height="200px" /></a>
                </div>
                <?php if (Mage::helper('core')->isModuleOutputEnabled('TM_QuickShopping')) : ?>
                    <?php echo Mage::helper('quickshopping')->getViewButton($this->__('Quick View'), $_product, $this->getMode(), null, $_productCollection); ?>
                <?php endif ?>
                <?php echo $this->getPriceHtml($_product, true) ?>
                <p class="product-name"><a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($_product->getName(), null, true) ?>"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></a></p>
                <?php echo Mage::helper('facebooklb')->getCategoryLikeButton($_product) ?>
            </li>
        <?php  if ($i%$_columnCount==0 || $i==$_collectionSize): ?>
        </ul>
        <?php   endif ?>
        <?php endforeach ?>
        <script type="text/javascript">decorateGeneric($$('ul.products-grid'), ['odd','even','first','last'])</script>

    <?php endif; ?>

    <div class="toolbar-bottom">
        <?php echo $this->getToolbarHtml() ?>  
    </div>
</div>
<?php endif; ?>
